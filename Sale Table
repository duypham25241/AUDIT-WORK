-- Create Stagting table
CREATE TABLE ProvinceSale (
    order_type NVARCHAR(MAX),
    department_code NVARCHAR(MAX),
    region_province_code NVARCHAR(MAX),
    ou_code NVARCHAR(MAX),
    store_ou_code NVARCHAR(MAX),
    management_account_code NVARCHAR(MAX),
    sale_date NVARCHAR(MAX),
    customer_code NVARCHAR(MAX),
    customer_name NVARCHAR(MAX),
    customer_type NVARCHAR(MAX),
    customer_segment NVARCHAR(MAX),
    walkin_customer_name NVARCHAR(MAX),
    walkin_customer_phone NVARCHAR(MAX),
    warehouse_code NVARCHAR(MAX),
    item_code NVARCHAR(MAX),
    item_name NVARCHAR(MAX),
    lot_number NVARCHAR(MAX),
    warehouse_entry_date NVARCHAR(MAX),
    production_date NVARCHAR(MAX),
    item_type NVARCHAR(MAX),
    sales_channel NVARCHAR(MAX),
    payment_method NVARCHAR(MAX),
    product_group_code NVARCHAR(MAX),
    transaction_uom NVARCHAR(MAX),
    transaction_qty NVARCHAR(MAX),
    uom_level1 NVARCHAR(MAX),
    qty_level1 NVARCHAR(MAX),
    uom_level2 NVARCHAR(MAX),
    qty_level2 NVARCHAR(MAX),
    cost_price_trans_uom1 NVARCHAR(MAX),
    cost_price_uom1 NVARCHAR(MAX),
    cost_price_trans_uom2 NVARCHAR(MAX),
    cost_price_uom2 NVARCHAR(MAX),
    cost_price_trans_uom3 NVARCHAR(MAX),
    cost_price_uom3 NVARCHAR(MAX),
    total_cost NVARCHAR(MAX),
    revenue NVARCHAR(MAX),
    gross_profit NVARCHAR(MAX),
    freight_terms NVARCHAR(MAX),
    shipping_method NVARCHAR(MAX),
    outsourcing_cost NVARCHAR(MAX),
    sales_order_no NVARCHAR(MAX),
    pos_web_no NVARCHAR(MAX),
    ar_transaction_no NVARCHAR(MAX),
    tax_code NVARCHAR(MAX),
    driver_name NVARCHAR(MAX),
    sales_person NVARCHAR(MAX),
    store_name NVARCHAR(MAX),
    location_code NVARCHAR(MAX),
    special_policy NVARCHAR(MAX),
    hoa_sen_voucher NVARCHAR(MAX),
    supplier_voucher NVARCHAR(MAX),
    commission_type NVARCHAR(MAX),
    commission_rate NVARCHAR(MAX),
    total_amount NVARCHAR(MAX),
    invoice_no NVARCHAR(MAX),
    delivery_address NVARCHAR(MAX)
);
-- Creatabe
CREATE TABLE ProvinceSale2 (
    [Order type] NVARCHAR(MAX),
    [Mã phòng ban] NVARCHAR(MAX),
    [Mã KV – Tỉnh] NVARCHAR(MAX),
    [Mã OU] NVARCHAR(MAX),
    [Mã OU cửa hàng] NVARCHAR(MAX),
    [Mã kế toán quản trị] NVARCHAR(MAX),
    [Ngày xuất bán] DATE,
    [Mã khách hàng] NVARCHAR(50),
    [Tên khách hàng] NVARCHAR(255),
    [Loại khách hàng] NVARCHAR(100),
    [Phân cấp khách hàng] NVARCHAR(100),
    [Tên KH vãng lai] NVARCHAR(255),
    [SĐT KH vãng lai] NVARCHAR(MAX),
    [Mã kho] NVARCHAR(50),
    [Mã hàng] NVARCHAR(MAX),
    [Tên hàng] NVARCHAR(255),
    [Mã lô] NVARCHAR(100),
    [Ngày nhập kho] DATE,
    [Ngày sản xuất] DATE,
    [Loại hàng] NVARCHAR(MAX),
    [Hình thức bán] NVARCHAR(MAX),
    [Hình thức thanh toán] NVARCHAR(MAX),
    [Mã nhóm hàng] NVARCHAR(100),
    [Số lượng ĐVT giao dịch] NVARCHAR(20),
    [Số lượng SL giao dịch] DECIMAL(18,4),
    [Số lượng ĐVT 1] NVARCHAR(MAX),
    [Số lượng SL 1] DECIMAL(18,4),
    [Số lượng ĐVT 2] NVARCHAR(20),
    [Số lượng SL 2] DECIMAL(18,4),
    [Đơn giá vốn (Không VAT) Đồng/ ĐVT giao dịch 1] DECIMAL(18,4),
    [Đơn giá vốn (Không VAT) Đồng/ ĐVT 1_1] DECIMAL(18,4),
    [Đơn giá vốn (Không VAT) Đồng/ ĐVT giao dịch 2] DECIMAL(18,4),
    [Đơn giá vốn (Không VAT) Đồng/ ĐVT 1_2] DECIMAL(18,4),
    [Đơn giá vốn (Không VAT) Đồng/ ĐVT giao dịch 3] DECIMAL(18,4),
    [Đơn giá vốn (Không VAT) Đồng/ ĐVT 1_3] DECIMAL(18,4),
    [Thành tiền vốn] DECIMAL(18,2),
    [Doanh thu] DECIMAL(18,2),
    [Lãi gộp] DECIMAL(18,2),
    [Freight Terms] NVARCHAR(100),
    [Hình thức vận chuyển] NVARCHAR(100),
    [Chi phí gia công ngoài] DECIMAL(18,2),
    [Số SO] NVARCHAR(100),
    [Số POS/WEB] NVARCHAR(100),
    [Số AR transaction] NVARCHAR(100),
    [Tax Code] NVARCHAR(MAX),
    [Tài xế giao hàng] NVARCHAR(100),
    [Nhân viên phụ trách đơn hàng] NVARCHAR(MAX),
    [Cửa hàng] NVARCHAR(MAX),
    [Mã địa] NVARCHAR(MAX),
    [CS đặc] NVARCHAR(100),
    [Voucher Hoa Sen] NVARCHAR(MAX),
    [Voucher NCC] NVARCHAR(MAX),
    [Loại chi HH] NVARCHAR(MAX),
    [Mức chi HH] DECIMAL(18,4),
    [Thành tiền] DECIMAL(18,2),
    [Số hóa đơn] NVARCHAR(MAX),
    [Nơi giao hàng] NVARCHAR(255)
);

-- INSERT INTO ProvinceSale2
SELECT [ordertype]
      ,[maphongban]
      ,[makvtinh]
      ,[maou]
      ,[maoucua_hang]
      ,[make_toan_quan_tri]
      ,CONVERT(DATE,[ngayxuatban],103) ngayxuatban
      ,[makhachhang]
      ,[tenkhachhang]
      ,[loaikhachhang]
      ,[phancapkhachhang]
      ,[tenkhvanglai]
      ,[sdtkhvanglai]
      ,[makho]
      ,[mahang]
      ,[tenhang]
      ,[malo]
      ,CONVERT(DATE,[ngaynhapkho],103) ngaynhapkho
      ,CONVERT(DATE,[ngaysanxuat],103) ngaysanxuat
      ,[loaihang]
      ,[hinhthucban]
      ,[hinhthucthanhtoan]
      ,[manhomhang]
      ,[soluong_dvt_giaodich]
      ,TRY_CONVERT(decimal,[soluong_sl_giaodich])SLgiaodich
      ,[soluong_dvt_1]
      ,TRY_CONVERT(decimal,[soluong_sl_1]) SL1
      ,[soluong_dvt_2]
      ,TRY_CONVERT(decimal,[soluong_sl_2]) SL2
      ,REPLACE(REPLACE(LTRIM(RTRIM([dongiavon_dvt_giaodich])),'.',''),',','.') dongiavon_dvt_giaodich
      ,REPLACE(REPLACE(LTRIM(RTRIM([dongiavon_dvt_1])),'.',''),',','.') dongiavon_dvt_1
      ,REPLACE(REPLACE(LTRIM(RTRIM([dongiavon_dvt_giaodich_2])),'.',''),',','.') dongiavon_dvt_giaodich_2
      ,REPLACE(REPLACE(LTRIM(RTRIM([dongiavon_dvt_1_2])),'.',''),',','.') dongiavon_dvt_2
      ,REPLACE(REPLACE(LTRIM(RTRIM([dongiavon_dvt_giaodich_3])),'.',''),',','.') dongiavon_dvt_giaodich_3
      ,REPLACE(REPLACE(LTRIM(RTRIM([dongiavon_dvt_1_3])),'.',''),',','.') dongiavon_dvt_3
      ,REPLACE(REPLACE(LTRIM(RTRIM([thanhtienvon])),'.',''),',','.') thanhtienvon
      ,REPLACE(REPLACE(LTRIM(RTRIM([doanhthu])),'.',''),',','.') doanhthu
      ,REPLACE(REPLACE(LTRIM(RTRIM([laigop])),'.',''),',','.') laigop
      ,[freightterms]
      ,[hinhthucvanchuyen]
      ,REPLACE(REPLACE(LTRIM(RTRIM([chiphi_giacongngoai])),'.',''),',','.') chiphi_giacongngoai
      ,[soso]
      ,[sopos_web]
      ,[soar_transaction]
      ,[taxcode]
      ,[taixegiaohang]
      ,[nhanvienphutrach]
      ,[cuahang]
      ,[madia]
      ,[csdac]
      ,[voucherhoasen]
      ,[voucherncc]
      ,[loaichihh]
      ,REPLACE(REPLACE(LTRIM(RTRIM([mucchihh])),'.',''),',','.') mucchihh
      ,REPLACE(REPLACE(LTRIM(RTRIM([thanhtien])),'.',''),',','.') thanhtien
      ,[sohoadon]
      ,[noigiaohang]
  FROM [HSG].[dbo].[ProvinceSale]
  
